# Веб-приложение на Django и Vue.js

Этот проект представляет собой полнофункциональное веб-приложение, состоящее из:
- Бэкенд: Python - Django/Django REST Framework, SQLite
- Фронтенд: TypeScript - Vue.js с Tailwind CSS и Pinia

## Инструменты разработки

Проект был разработан с использованием следующих инструментов:
- PyCharm - для разработки серверной части (Django)
- WebStorm - для разработки клиентской части (Vue.js)
- Postman - для тестирования API

## Системные требования

- Python 3.10 или выше
- Node.js 18 или выше
- npm (устанавливается вместе с Node.js)

## Установка

### 1. Скачивание и установка необходимого ПО

#### Python
1. Перейдите на [официальный сайт Python](https://www.python.org/downloads/)
2. Скачайте и установите Python 3.10 или выше
3. При установке выберите опцию "Add Python to PATH"

#### Node.js
1. Перейдите на [официальный сайт Node.js](https://nodejs.org/)
2. Скачайте и установите Node.js 18 или выше (рекомендуется LTS-версия)

### 2. Скачайте проект с гитхаб

1. Нажмите на зелёную кнопку "<> Code" вверху страницы
2. Нажмите скачать zip
3. Распакуйте проект в удобное место

## Запуск проекта

### Автоматический запуск

Для удобства в проекте предусмотрены скрипты автоматического запуска:

#### Windows
Просто запустите файл `start_project.bat`, дважды кликнув по нему в проводнике.

#### Linux/MacOS
Сделайте скрипт исполняемым и запустите его:
```bash
chmod +x start_project.sh
./start_project.sh
```

Скрипты запустят и бэкенд, и фронтенд одновременно.

Бэкенд будет доступен по адресу: http://localhost:8000/

Панель администратора Django: http://localhost:8000/admin/
Логин: admin
Пароль: admin

Фронтенд будет доступен по адресу: http://localhost:3000/

## Структура проекта

### Бэкенд
- `server/`: Основная директория Django проекта
- `core/`: Основное приложение Django
- `server/settings.py`: Настройки проекта Django
- `requirements.txt`: Зависимости Python

### Фронтенд
- `client/`: Основная директория Vue.js проекта
- `client/src/`: Исходный код Vue приложения
- `client/src/views/`: Vue компоненты страниц
- `client/src/components/`: Переиспользуемые Vue компоненты
- `client/src/api/`: API клиент для взаимодействия с бэкендом
- `client/src/stores/`: Хранилища состояния Pinia
- `client/public/`: Статические файлы

## Структура базы данных

Проект использует следующие модели базы данных:

### Venue (Заведение)
- id - уникальный номер записи
- user - связь с моделью пользователя Django (OneToOne)
- name - название заведения
- city - город
- phone - телефон
- qr_code - QR-код для запросов треков
- balance - баланс заведения

### Genre (Жанр)
- name - название жанра музыки

### Track (Трек)
- id - уникальный номер записи
- venue - связь с заведением (Foreign Key)
- genre - связь с жанром (Foreign Key)
- title - название трека
- artist - исполнитель
- icon - иконка/изображение
- price - стоимость запроса трека

### TrackRequest (Запрос трека)
- id - уникальный номер записи
- track - связь с треком (Foreign Key)
- user_fee - плата пользователя
- status - статус запроса (ожидает/принят/отклонен)
- is_paid - статус оплаты
- created_at - дата и время создания
- transaction_id - ID транзакции
- payment_token - токен для оплаты
- payment_id - ID платежа

### Transaction (Транзакция)
- id - уникальный номер записи
- venue - связь с заведением (Foreign Key)
- amount - сумма
- transaction_type - тип транзакции (пополнение/списание)
- track_request - связь с запросом трека (Foreign Key)
- created_at - дата и время создания

### WithdrawalRequest (Запрос на вывод средств)
- id - уникальный номер записи
- venue - связь с заведением (Foreign Key)
- amount - сумма
- status - статус запроса
- created_at - дата и время создания
- yookassa_payout_id - ID выплаты в платежной системе
- bank_card_token - токен банковской карты
- fee - комиссия

## Функционирование проекта

### Архитектура проекта

Проект построен по принципу SPA (Single Page Application) с разделением на frontend и backend части:

- **Backend (Django)** - отвечает за бизнес-логику, работу с базой данных и предоставление API
- **Frontend (Vue.js)** - отвечает за пользовательский интерфейс и взаимодействие с пользователем

### Серверная часть (Django)

Серверная часть реализована на Django с использованием Django REST Framework для создания RESTful API. 

1. **Аутентификация и авторизация**:
   - Используется JWT (JSON Web Tokens) через библиотеку `rest_framework_simplejwt`
   - Токены доступа имеют срок действия 30 дней
   - Регистрация новых заведений через эндпоинт `/api/register/`
   - Авторизация через получение токена в `/api/token/`

2. **Основные API эндпоинты**:
   - `/api/profile/` - управление профилем заведения
   - `/api/genres/` - работа с жанрами музыки
   - `/api/venue/{id}/tracks/` - управление треками конкретного заведения
   - `/api/venue/{id}/request/` - создание запросов на проигрывание трека
   - `/api/requests/` - управление запросами на проигрывание
   - `/api/withdrawals/` - запросы на вывод средств
   - `/api/transactions/` - история транзакций

3. **Интеграция с платежной системой**:
   - Настроена интеграция с платежным шлюзом ЮKassa
   - Поддержка вебхуков для обработки событий платежей
   - Тестовый режим оплаты через `/api/requests/pay/{token}/`

4. **QR-коды**:
   - Генерация уникальных QR-кодов для каждого заведения
   - QR-код содержит ссылку на страницу запроса треков (`/venue/{id}/request`)

### Клиентская часть (Vue.js)

Клиентская часть представляет собой SPA на Vue.js с использованием TypeScript и Tailwind CSS.

1. **Маршрутизация**:
   - Реализована с помощью Vue Router
   - Публичные страницы: Домашняя, Вход, Регистрация, Запрос трека
   - Защищенные страницы (требуют авторизации): Дашборд, Управление треками, Запросы, Финансы, Выводы

2. **Управление состоянием**:
   - Использует Pinia для управления состоянием приложения
   - Основные хранилища: auth, tracks, requests, finance

3. **Взаимодействие с API**:
   - Использует axios для HTTP-запросов
   - Автоматическое добавление токена авторизации ко всем запросам
   - Обработка ошибок авторизации (перенаправление на страницу входа)

4. **Основные функции**:
   - Регистрация и авторизация заведений
   - Управление треками (добавление, редактирование, удаление)
   - Просмотр и обработка запросов на проигрывание
   - Управление финансами (просмотр баланса, история транзакций)
   - Вывод средств на банковскую карту

### Процесс работы приложения

1. **Заведение (Venue)**:
   - Регистрируется в системе
   - Настраивает свой профиль
   - Добавляет треки с указанием стоимости
   - Распечатывает/размещает QR-код для клиентов

2. **Посетитель**:
   - Сканирует QR-код заведения
   - Выбирает трек из доступных
   - Оплачивает заказ через платежную систему
   - Заведение получает уведомление о новом запросе

3. **Обработка запросов**:
   - Заведение видит все входящие запросы в разделе "Запросы"
   - Может принять или отклонить запрос
   - При принятии трек добавляется в очередь на проигрывание
   - Сумма запроса (за вычетом комиссии) зачисляется на баланс заведения

4. **Финансовые операции**:
   - Заведение отслеживает свой баланс в разделе "Финансы"
   - Видит историю всех транзакций
   - Может запросить вывод средств на банковскую карту
   - Система обрабатывает запросы на вывод через платежный шлюз

Таким образом, приложение обеспечивает полный цикл взаимодействия между заведениями и их посетителями, позволяя организовать удобную систему заказа музыки и оплаты.
